name: Deploy Angular + PHP via rsync

# O deploy ser√° disparado sempre que houver um push para a branch 'main' (ou 'master')
on:
  push:
    branches:
      # - main # Descomente se sua branch principal for main
      - master # Descomente se sua branch principal for master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout do c√≥digo
      - name: üöö Get latest code
        uses: actions/checkout@v4

      # 2. Instalar Node.js e Angular CLI
      - name: üõ†Ô∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22.21.0' # Use a vers√£o de Node que seu Angular exige
          cache: 'npm'
      
      # 3. Instalar depend√™ncias (ex: do package.json)
      - name: üì¶ Install dependencies
        run: npm ci

      # 4. Fazer o Build de Produ√ß√£o do Angular
      - name: üèóÔ∏è Build Angular App
        run: ng build --configuration production
        # O comando 'ng build' ir√° gerar sua build na pasta 'dist/nome-do-seu-projeto'

      # 5. Configurar e Sincronizar com a HostGator via Rsync/SSH
      - name: üöÄ Deploy to HostGator via Rsync
        uses: burnett01/rsync-deployments@7.1.0 # Action popular para rsync
        with:
          # --- Configura√ß√µes SSH (usando os Secrets) ---
          remote_host: ${{ secrets.SSH_HOST }}
          remote_user: ${{ secrets.SSH_USER }}
          remote_key: ${{ secrets.SSH_PRIVATE_KEY }}
          
          # A HostGator Compartilhada geralmente usa a porta 2222
          remote_port: 2222
          
          # --- Configura√ß√µes Rsync/Deploy ---
          # O caminho LOCAL da sua pasta dist. 
          # O '/' final √© crucial para COPIAR O CONTE√öDO (os arquivos .js, .css, index.html)
          # Ajuste 'nome-do-seu-projeto' se for diferente (Ex: 'frontend-app')
          path: src/frontend/app/dist/app/ 
          
          # O caminho REMOTO (public_html/ √© a raiz do seu site)
          remote_path: '~/calc.zantech.com.br/' 
          
          # Op√ß√µes do Rsync: 
          # -avz (archive, verbose, compress) 
          # --delete (Apaga arquivos no destino que n√£o existem mais na origem)
          switches: -avzr --delete